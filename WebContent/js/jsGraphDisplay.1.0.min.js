//http://blog.niap3d.com/jsGraphDisplay
function jsGraphDisplay(t){var e=this;return e.SVGInit=function(t,e){var a=this;return a.Line=function(t,e,i){var n,o,x,l="",r=a.Element("path");for(o=0,x=t.length;o<x;o++)if(""!=l){switch(e.type){case"bezier":n=a.parent.BezierCalc(t[o-1],t[o],t[o+1]),l+=1==o?" C "+t[o-1][0]+","+t[o-1][1]+" "+(t[o][0]+n[0])+", "+(t[o][1]+n[1]):" S "+(t[o][0]+n[0])+", "+(t[o][1]+n[1]);break;default:l+=" L"}l+=" "+t[o][0]+", "+t[o][1]}else l="M "+t[o][0]+","+t[o][1];r.setAttribute("d",l),r.setAttribute("fill","none"),e.dash&&r.setAttribute("stroke-dasharray",e.dash),e.color&&(r.style.stroke=e.color),r.style.strokeWidth=e.width,a.domElement.appendChild(r)},a.Triangle=function(t,e,i,n){var o=a.Element("polygon");o.setAttribute("points",+t[0]+","+t[1]+" "+e[0]+","+e[1]+" "+i[0]+","+i[1]),n.color&&o.setAttribute("fill",n.color),a.domElement.appendChild(o)},a.Rectangle=function(t,e,i,n){var o=a.Element("rect");o.setAttribute("x",t[0]),o.setAttribute("y",t[1]),o.setAttribute("width",e),o.setAttribute("height",i),n.color&&o.setAttribute("fill",n.color),a.domElement.appendChild(o)},a.Circle=function(t,e,i){var n=a.Element("circle");n.setAttribute("cx",t[0]),n.setAttribute("cy",t[1]),n.setAttribute("r",e),i.color&&n.setAttribute("fill",i.color),a.domElement.appendChild(n)},a.Text=function(t,e,i){var n,o=a.Element("text");if(o.setAttribute("x",e[0]),o.setAttribute("y",e[1]),o.innerHTML=t,i.color&&(o.style.fill=i.color),i.fontSize&&o.setAttribute("font-size",i.fontSize),i.textBaseline){switch(i.textBaseline){case"top":n="hanging";break;case"bottom":n="baseline";break;default:n="middle"}o.setAttribute("alignment-baseline",n)}if(i.textAlign){switch(i.textAlign){case"left":n="start";break;case"right":n="end";break;default:n="middle"}o.style.textAnchor=n}i.rotation&&o.setAttribute("transform","rotate("+i.rotation+", "+e[0]+", "+e[1]+")"),a.domElement.appendChild(o)},a.Element=function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)},a.domElement=t,a.parent=e,a},e.CanvasInit=function(t,e){var a=this;return a.Line=function(t,e){e.width&&(a.context.lineWidth=e.width),e.color&&(a.context.strokeStyle=e.color),e.dash&&a.context.setLineDash(e.dash),a.context.beginPath(),a.context.moveTo(t[0][0],t[0][1]);var n,o=[0,0];for(i=1,j=t.length;i<j;i++)switch(e.type){case"bezier":n=a.parent.BezierCalc(t[i-1],t[i],t[i+1]),a.context.bezierCurveTo(t[i-1][0]-o[0],t[i-1][1]-o[1],t[i][0]+n[0],t[i][1]+n[1],t[i][0],t[i][1]),o=n;break;default:a.context.lineTo(t[i][0],t[i][1])}a.context.stroke()},a.Triangle=function(t,e,i,n){n.color&&(a.context.strokeStyle=n.color),a.context.beginPath(),a.context.moveTo(t[0],t[1]),a.context.lineTo(e[0],e[1]),a.context.lineTo(i[0],i[1]),a.context.fill()},a.Rectangle=function(t,e,i,n){n.color&&(a.context.fillStyle=n.color),a.context.strokeStyle="",a.context.beginPath(),a.context.rect(t[0],t[1],e,i),a.context.fill()},a.Circle=function(t,e,i){i.color&&(a.context.fillStyle=i.color),a.context.beginPath(),a.context.arc(t[0],t[1],e,0,2*Math.PI),a.context.fill()},a.Text=function(t,e,i){i.fontSize&&(a.context.font=i.fontSize+"px Arial"),i.textBaseline&&(a.context.textBaseline=i.textBaseline),i.width&&(a.context.lineWidth=i.width),i.color&&(a.context.fillStyle=i.color),i.textAlign&&(a.context.textAlign=i.textAlign),i.rotation?(a.context.save(),a.context.translate(e[0],e[1]),a.context.rotate(i.rotation/180*Math.PI),a.context.fillText(t,0,0),a.context.restore()):a.context.fillText(t,e[0],e[1])},a.context=t.getContext("2d"),a.parent=e,a},e.Draw=function(t,a){var i,n,o,x,l,r,s,d,c,y,m,p,h,u,g;if(!(i=document.getElementById(t)))return console.warn("jsSimpleGraph : DOM element #"+t+" not found"),0;switch(i.tagName){case"CANVAS":if(!i.getContext)return console.warn("jsSimpleGraph : Browser incompatible with getContext"),0;d=e.CanvasInit(i,this);break;case"svg":d=e.SVGInit(i,this);break;default:return console.warn("jsSimpleGraph : Element need to be canvas or SVG ("+i.tagName+")"),0}for(5,n=e.margin.left+(e.axe.y.title?e.axe.y.textSize+5:0)+(e.axe.y.textDisplayEvery?e.axe.y.max.toString().length*e.axe.y.textSize*.7+5:0),o=i.getBoundingClientRect().width-e.margin.right,x=e.margin.top,l=i.getBoundingClientRect().height-e.margin.bottom-(e.axe.x.title?e.axe.x.textSize+5:0)-(e.axe.x.textDisplayEvery?e.axe.x.textSize+5:0),r=(e.axe.x.max-e.axe.x.min)/(o-n),s=(e.axe.y.max-e.axe.y.min)/(l-x),d.Line([[n,x],[n,l],[o,l]],{type:"line",width:e.axe.width,color:e.axe.color}),e.axe.arrow&&(d.Triangle([n,x-5],[n-5,x],[n+5,x],{color:e.axe.color}),d.Triangle([o+5,l],[o,l+5],[o,l-5],{color:e.axe.color})),e.axe.x.title&&d.Text(e.axe.x.title,[n+(o-n)/2,i.getBoundingClientRect().height],{fontSize:e.axe.x.textSize,textBaseline:"bottom",textAlign:"center",color:e.axe.x.textColor}),e.axe.y.title&&d.Text(e.axe.y.title,[0,x+(l-x)/2],{fontSize:e.axe.y.textSize,textBaseline:"top",textAlign:"center",rotation:-90,color:e.axe.y.textColor}),y=(e.axe.x.max-e.axe.x.min)/e.axe.x.step,c=1;c<=y;c++)m=n+e.axe.x.step*c/r,e.grid.x.width&&d.Line([[m,l-5],[m,x]],{type:"line",width:e.grid.x.width,color:e.grid.y.color}),d.Line([[m,l-5],[m,l+5]],{type:"line",width:e.axe.width,color:e.axe.color}),c%e.axe.x.textDisplayEvery==0&&(g=e.axe.x.min+c*e.axe.x.step,g=e.axe.x.list?e.axe.x.list[g/e.axe.x.max*e.axe.x.list.length-1]:Math.floor(g),d.Text(g,[m,l+10],{fontSize:e.axe.x.textSize,color:e.axe.x.textColor,textBaseline:"top",textAlign:"center"}));for(y=(e.axe.y.max-e.axe.y.min)/e.axe.y.step,c=1;c<=y;c++)p=l-e.axe.y.step*c/s,e.grid.y.width&&d.Line([[n+5,p],[o,p]],{type:"line",width:e.grid.y.width,color:e.grid.y.color}),d.Line([[n-5,p],[n+5,p]],{type:"line",width:e.axe.width,color:e.axe.color}),c%e.axe.y.textDisplayEvery==0&&(g=e.axe.y.min+c*e.axe.y.step,g=e.axe.y.list?e.axe.y.list[g/e.axe.y.max*e.axe.y.list.length-1]:Math.floor(g),d.Text(g,[n-10,p],{fontSize:e.axe.y.textSize,color:e.axe.y.textColor,textBaseline:"middle",textAlign:"right"}));for(c=0;c<e.dataLst.length;c++)if(!(a instanceof Array&&-1===a.indexOf(e.dataLst[c].title)||"string"==typeof a&&e.dataLst[c].title!==a)){for(h=0,u=[],y=0;y<e.dataLst[c].data.length;y++)if(m=n+(e.dataLst[c].data[y][0]-e.axe.x.min)/r,p=l-(e.dataLst[c].data[y][1]-e.axe.y.min)/s,u.push({x:m,y:p}),e.dataLst[c].display.linkWidth>0)switch(e.dataLst[c].display.linkType){case"toTop":case"toBottom":d.Line([[m,"toTop"==e.dataLst[c].display.linkType?x:l],[m,p]],{type:"line",width:e.dataLst[c].display.linkWidth,color:e.dataLst[c].display.linkColor,dash:e.dataLst[c].display.linkDash});break;default:h||(h=[]),0==y&&e.dataLst[c].display.linkFromZero&&(h=[[n,l]]),h.push([m,p])}for(h&&d.Line(h,{type:e.dataLst[c].display.linkType,width:e.dataLst[c].display.linkWidth,color:e.dataLst[c].display.linkColor,dash:e.dataLst[c].display.linkDash}),y=0;y<u.length;y++)switch(m=u[y].x,p=u[y].y,e.dataLst[c].display.dataType){case"rectangle":d.Rectangle([m-e.dataLst[c].display.dataWidth/2,p-e.dataLst[c].display.dataWidth/2],e.dataLst[c].display.dataWidth,e.dataLst[c].display.dataWidth,{color:e.dataLst[c].display.dataColor});break;case"circle":d.Circle([m,p],e.dataLst[c].display.dataWidth/2,{color:e.dataLst[c].display.dataColor})}}},e.DataAdd=function(t){var a,i,n,o,x,l=[];if(l.title=e.VarInit(t,"title",""),l.data=e.VarInit(t,"data",[]),l.data.length<=0)return 0;for(a=0;a<l.data.length;a++)(l.data[a][0]<i||void 0===i)&&(i=l.data[a][0]),(l.data[a][0]>n||void 0===n)&&(n=l.data[a][0]),(l.data[a][1]<o||void 0===o)&&(o=l.data[a][1]),(l.data[a][1]>x||void 0===x)&&(x=l.data[a][1]);return l.limit={},l.limit.x={min:i,max:n},l.limit.y={min:o,max:x},l.display={},l.display.linkWidth=e.VarInit(t,"display.linkWidth",1),l.display.linkColor=e.VarInit(t,"display.linkColor","#ccc"),l.display.linkDash=e.VarInit(t,"display.linkDash",[]),l.display.linkFromZero=e.VarInit(t,"display.linkFromZero",!1),l.display.linkType=e.VarInit(t,"display.linkType","linkData"),l.display.dataType=e.VarInit(t,"display.dataType","rectangle"),l.display.dataWidth=e.VarInit(t,"display.dataWidth",4),l.display.dataColor=e.VarInit(t,"display.dataColor","#000"),e.dataLst.push(l),e.LimitInit(),1},e.DataDelete=function(t){for(i=0;i<e.dataLst.length;i++)if(e.dataLst[i].title==t)return e.dataLst.splice(i,1),1;return 0},e.BezierCalc=function(t,e,a){var i=0,n=0;return a&&(m=(a[1]-t[1])/(a[0]-t[0]),n=(i=-.3*(a[0]-e[0]))*m*.6),[i,n]},e.LimitInit=function(t){if(e.axe.x.minAuto||e.axe.x.maxAuto||e.axe.y.minAuto||e.axe.y.maxAuto){var a,i,n,o,x;for(x=0;x<e.dataLst.length;x++)(e.dataLst[x].limit.x.min<a||void 0===a)&&(a=e.dataLst[x].limit.x.min),(e.dataLst[x].limit.x.max>i||void 0===i)&&(i=e.dataLst[x].limit.x.max),(e.dataLst[x].limit.y.min<n||void 0===n)&&(n=e.dataLst[x].limit.y.min),(e.dataLst[x].limit.y.max>o||void 0===o)&&(o=e.dataLst[x].limit.y.max);e.axe.x.minAuto&&(e.axe.x.min=a),e.axe.x.maxAuto&&(e.axe.x.max=i),e.axe.y.minAuto&&(e.axe.y.min=n),e.axe.y.maxAuto&&(e.axe.y.max=o)}e.axe.x.stepAuto&&(e.axe.x.step=(e.axe.x.max-e.axe.x.min)/(e.axe.x.list?e.axe.x.list.length:10)),e.axe.y.stepAuto&&(e.axe.y.step=(e.axe.y.max-e.axe.y.min)/(e.axe.y.list?e.axe.y.list.length:10))},e.VarInit=function(t,e,a){var i=e.split(".").reduce(function(t,e){return t?t[e]:void 0},t);return void 0===i?a:i},e.dataLst=[],e.margin={},e.margin.top=e.VarInit(t,"margin.top",5),e.margin.right=e.VarInit(t,"margin.right",5),e.margin.bottom=e.VarInit(t,"margin.bottom",5),e.margin.left=e.VarInit(t,"margin.left",5),e.axe={},e.axe.arrow=e.VarInit(t,"axe.arrow",!0),e.axe.width=e.VarInit(t,"axe.thickness",2),e.axe.color=e.VarInit(t,"axe.color","#000"),e.axe.x={},e.axe.x.title=e.VarInit(t,"axe.x.title",""),e.axe.x.list=e.VarInit(t,"axe.x.list",""),e.axe.x.min=e.VarInit(t,"axe.x.min","auto"),e.axe.x.max=e.VarInit(t,"axe.x.max","auto"),e.axe.x.step=e.VarInit(t,"axe.x.step","auto"),e.axe.x.minAuto="auto"==e.axe.x.min,e.axe.x.maxAuto="auto"==e.axe.x.max,e.axe.x.stepAuto="auto"==e.axe.x.step,e.axe.x.textDisplayEvery=e.VarInit(t,"axe.x.textDisplayEvery",1),e.axe.x.textSize=e.VarInit(t,"axe.x.textSize",12),e.axe.x.textColor=e.VarInit(t,"axe.x.textColor","#000"),e.axe.y={},e.axe.y.title=e.VarInit(t,"axe.y.title",""),e.axe.y.list=e.VarInit(t,"axe.y.list",""),e.axe.y.min=e.VarInit(t,"axe.y.min","auto"),e.axe.y.max=e.VarInit(t,"axe.y.max","auto"),e.axe.y.step=e.VarInit(t,"axe.y.step","auto"),e.axe.y.minAuto="auto"===e.axe.y.min,e.axe.y.maxAuto="auto"===e.axe.y.max,e.axe.y.stepAuto="auto"===e.axe.y.step,e.axe.y.textDisplayEvery=e.VarInit(t,"axe.y.textDisplayEvery",1),e.axe.y.textSize=e.VarInit(t,"axe.y.textSize",12),e.axe.y.textColor=e.VarInit(t,"axe.y.textColor","#000"),e.grid={},e.grid.x={},e.grid.x.width=e.VarInit(t,"grid.x.thickness",1),e.grid.x.color=e.VarInit(t,"grid.x.color","#f0f0f0"),e.grid.y={},e.grid.y.width=e.VarInit(t,"grid.y.thickness",1),e.grid.y.color=e.VarInit(t,"grid.y.color","#f0f0f0"),e}